<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css">
  <script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.zerchin.xyz","root":"/","images":"/images","scheme":"Gemini","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="刚刚更新了版本，就忍不住想安装一下，因时间有限，只安装到了dashboari搭建过程中，跟着官网走了遍流程，基本上没啥问题建议还是跟着官网搭一遍会舒服很多 https:&#x2F;&#x2F;docs.openstack.org&#x2F;install-guide因为是自己搭着玩，为了方便，所有关于密码的设置，都设置成000000 配置">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS7.5安装OpenStack Rocky版本">
<meta property="og:url" content="http://blog.zerchin.xyz/2018/09/04/CentOS7.5%E5%AE%89%E8%A3%85OpenStack_Rocky%E7%89%88%E6%9C%AC/index.html">
<meta property="og:site_name" content="zerchin 云技术栈">
<meta property="og:description" content="刚刚更新了版本，就忍不住想安装一下，因时间有限，只安装到了dashboari搭建过程中，跟着官网走了遍流程，基本上没啥问题建议还是跟着官网搭一遍会舒服很多 https:&#x2F;&#x2F;docs.openstack.org&#x2F;install-guide因为是自己搭着玩，为了方便，所有关于密码的设置，都设置成000000 配置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.zerchin.xyz/images/mk/openstack-install-guide/dashboard.png">
<meta property="article:published_time" content="2018-09-04T18:20:21.000Z">
<meta property="article:modified_time" content="2022-07-19T08:23:02.047Z">
<meta property="article:author" content="zerchin">
<meta property="article:tag" content="openstack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.zerchin.xyz/images/mk/openstack-install-guide/dashboard.png">


<link rel="canonical" href="http://blog.zerchin.xyz/2018/09/04/CentOS7.5%E5%AE%89%E8%A3%85OpenStack_Rocky%E7%89%88%E6%9C%AC/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>CentOS7.5安装OpenStack Rocky版本 | zerchin 云技术栈</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">zerchin 云技术栈</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Kubernetes && Openstack engineer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">42</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">86</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">1.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-number">2.</span> <span class="nav-text">关闭防火墙</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">3.</span> <span class="nav-text">更新软件包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%AE%8C%E6%88%90%E5%90%8E%E9%87%8D%E5%90%AF%E7%B3%BB%E7%BB%9F"><span class="nav-number">4.</span> <span class="nav-text">更新完成后重启系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="nav-number">5.</span> <span class="nav-text">设置主机名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%BB%E6%9C%BA%E6%98%A0%E5%B0%84"><span class="nav-number">6.</span> <span class="nav-text">添加主机映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5"><span class="nav-number">7.</span> <span class="nav-text">配置时间同步</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#controller%E8%8A%82%E7%82%B9"><span class="nav-number">7.1.</span> <span class="nav-text">controller节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">7.2.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-chrony-conf%E6%96%87%E4%BB%B6"><span class="nav-number">7.3.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;chrony.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">7.4.</span> <span class="nav-text">启动服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#compute%E8%8A%82%E7%82%B9"><span class="nav-number">7.4.1.</span> <span class="nav-text">compute节点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-1"><span class="nav-number">7.5.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-chrony-conf%E6%96%87%E4%BB%B6-1"><span class="nav-number">7.6.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;chrony.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-1"><span class="nav-number">7.7.</span> <span class="nav-text">启动服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEOpenStack-rocky%E7%9A%84yum%E6%BA%90%E6%96%87%E4%BB%B6"><span class="nav-number">8.</span> <span class="nav-text">配置OpenStack-rocky的yum源文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85OpenStack%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8Cselinux%E6%9C%8D%E5%8A%A1"><span class="nav-number">9.</span> <span class="nav-text">安装OpenStack客户端和selinux服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1"><span class="nav-number">10.</span> <span class="nav-text">安装数据库服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8controller%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">10.1.</span> <span class="nav-text">在controller节点安装数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">10.2.</span> <span class="nav-text">修改数据库配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1"><span class="nav-number">10.3.</span> <span class="nav-text">启动数据库服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81"><span class="nav-number">10.4.</span> <span class="nav-text">设置数据库密码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">11.</span> <span class="nav-text">安装消息队列服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8controller%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85rabbitmq-server"><span class="nav-number">11.1.</span> <span class="nav-text">在controller节点安装rabbitmq-server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">11.2.</span> <span class="nav-text">启动消息队列服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0openstack%E7%94%A8%E6%88%B7"><span class="nav-number">11.3.</span> <span class="nav-text">添加openstack用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEopenstack%E7%94%A8%E6%88%B7%E6%9C%80%E9%AB%98%E6%9D%83%E9%99%90"><span class="nav-number">11.4.</span> <span class="nav-text">设置openstack用户最高权限</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85memcached-%E6%9C%8D%E5%8A%A1"><span class="nav-number">12.</span> <span class="nav-text">安装memcached 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8controller%E8%8A%82%E7%82%B9%E4%B8%8A%E5%AE%89%E8%A3%85memcached"><span class="nav-number">12.1.</span> <span class="nav-text">在controller节点上安装memcached</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9memcached%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">12.2.</span> <span class="nav-text">修改memcached配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8memcached%E6%9C%8D%E5%8A%A1"><span class="nav-number">12.3.</span> <span class="nav-text">启动memcached服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85etcd%E6%9C%8D%E5%8A%A1"><span class="nav-number">13.</span> <span class="nav-text">安装etcd服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8controller%E8%8A%82%E7%82%B9%E4%B8%8A%E5%AE%89%E8%A3%85etcd%E6%9C%8D%E5%8A%A1"><span class="nav-number">13.1.</span> <span class="nav-text">在controller节点上安装etcd服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9etcd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E4%BD%BF%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E8%83%BD%E5%A4%9F%E8%AE%BF%E9%97%AE"><span class="nav-number">13.2.</span> <span class="nav-text">修改etcd配置文件，使其他节点能够访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8etcd%E6%9C%8D%E5%8A%A1"><span class="nav-number">13.3.</span> <span class="nav-text">启动etcd服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85keystone%E6%9C%8D%E5%8A%A1"><span class="nav-number">14.</span> <span class="nav-text">安装keystone服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">14.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-2"><span class="nav-number">14.2.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-keystone-keystone-conf"><span class="nav-number">14.3.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;keystone&#x2F;keystone.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">14.4.</span> <span class="nav-text">同步数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96fernet-key%E5%BA%93"><span class="nav-number">14.5.</span> <span class="nav-text">初始化fernet key库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%AF%BC%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="nav-number">14.6.</span> <span class="nav-text">引导身份认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91httpd%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-httpd-conf-httpd-conf"><span class="nav-number">14.7.</span> <span class="nav-text">编辑httpd配置文件&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5"><span class="nav-number">14.8.</span> <span class="nav-text">创建文件链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8httpd%E6%9C%8D%E5%8A%A1"><span class="nav-number">14.9.</span> <span class="nav-text">启动httpd服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%84%9A%E6%9C%ACadmin-openrc"><span class="nav-number">14.10.</span> <span class="nav-text">编写环境变量脚本admin-openrc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAservice%E9%A1%B9%E7%9B%AE"><span class="nav-number">14.11.</span> <span class="nav-text">创建service项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#glance%E5%AE%89%E8%A3%85"><span class="nav-number">15.</span> <span class="nav-text">glance安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">15.1.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AD%89"><span class="nav-number">15.2.</span> <span class="nav-text">创建用户、服务等</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-3"><span class="nav-number">15.3.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-glance-glance-api-conf"><span class="nav-number">15.4.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;glance&#x2F;glance-api.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-glance-glance-registry-conf"><span class="nav-number">15.5.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;glance&#x2F;glance-registry.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="nav-number">15.6.</span> <span class="nav-text">同步数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-2"><span class="nav-number">15.7.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81"><span class="nav-number">15.8.</span> <span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85nova%E6%9C%8D%E5%8A%A1"><span class="nav-number">16.</span> <span class="nav-text">安装nova服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#controller%E8%8A%82%E7%82%B9-1"><span class="nav-number">16.1.</span> <span class="nav-text">controller节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-2"><span class="nav-number">16.2.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%85%B3%E7%94%A8%E6%88%B7%E3%80%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">16.3.</span> <span class="nav-text">创建相关用户、服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-4"><span class="nav-number">16.4.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-nova-nova-conf"><span class="nav-number">16.5.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;nova&#x2F;nova.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-httpd-conf-d-00-nova-placement-api-conf%EF%BC%8C%E6%B7%BB%E5%8A%A0%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9"><span class="nav-number">16.6.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;00-nova-placement-api.conf，添加以下内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%90%AFhttpd%E6%9C%8D%E5%8A%A1"><span class="nav-number">16.7.</span> <span class="nav-text">重启httpd服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5nova-api%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">16.8.</span> <span class="nav-text">同步nova_api数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%86%8Ccell0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">16.9.</span> <span class="nav-text">注册cell0数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAcell1%E5%8D%95%E5%85%83"><span class="nav-number">16.10.</span> <span class="nav-text">创建cell1单元</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5nova%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">16.11.</span> <span class="nav-text">同步nova数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81cell0%E5%92%8Ccell1%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F"><span class="nav-number">16.12.</span> <span class="nav-text">验证cell0和cell1注册成功</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-3"><span class="nav-number">16.13.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compute%E8%8A%82%E7%82%B9-1"><span class="nav-number">16.14.</span> <span class="nav-text">compute节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-5"><span class="nav-number">16.15.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-nova-nova-conf-1"><span class="nav-number">16.16.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;nova&#x2F;nova.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E8%99%9A%E6%8B%9F%E5%8C%96"><span class="nav-number">16.17.</span> <span class="nav-text">检查是否支持虚拟化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-4"><span class="nav-number">16.18.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#controller%E8%8A%82%E7%82%B9-2"><span class="nav-number">16.19.</span> <span class="nav-text">controller节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E8%AE%A4%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9C%89%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="nav-number">16.20.</span> <span class="nav-text">确认数据库中有计算节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E7%8E%B0%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="nav-number">16.21.</span> <span class="nav-text">发现计算节点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85neutron%E6%9C%8D%E5%8A%A1"><span class="nav-number">17.</span> <span class="nav-text">安装neutron服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#controller%E8%8A%82%E7%82%B9-3"><span class="nav-number">17.1.</span> <span class="nav-text">controller节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-3"><span class="nav-number">17.2.</span> <span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E3%80%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">17.3.</span> <span class="nav-text">创建用户、服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEprovider-network%E7%BD%91%E7%BB%9C"><span class="nav-number">17.4.</span> <span class="nav-text">配置provider network网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-6"><span class="nav-number">17.5.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-neutron-conf%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">17.6.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;neutron.conf配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-neutron-plugins-ml2-ml2-conf-ini"><span class="nav-number">17.7.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-plugins-ml2-linuxbridge-agent-ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">17.8.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-neutron-dhcp-agent-ini"><span class="nav-number">17.9.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AESelf-service%E7%BD%91%E7%BB%9C"><span class="nav-number">17.10.</span> <span class="nav-text">配置Self-service网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-7"><span class="nav-number">17.11.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-etc-neutron-neutron-conf%E6%96%87%E4%BB%B6"><span class="nav-number">17.12.</span> <span class="nav-text">配置&#x2F;etc&#x2F;neutron&#x2F;neutron.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-plugins-ml2-ml2-conf-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.13.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;ml2_conf.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-plugins-ml2-linuxbridge-agent-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.14.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-l3-agent-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.15.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;l3_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-dhcp-agent-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.16.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;dhcp_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-neutron-metadata-agent-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.17.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;neutron&#x2F;metadata_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-nova-nova-conf%E6%96%87%E4%BB%B6"><span class="nav-number">17.18.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;nova&#x2F;nova.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%93%BE%E6%8E%A5"><span class="nav-number">17.19.</span> <span class="nav-text">创建链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%BA%93-2"><span class="nav-number">17.20.</span> <span class="nav-text">同步数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-5"><span class="nav-number">17.21.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compute%E8%8A%82%E7%82%B9-2"><span class="nav-number">17.22.</span> <span class="nav-text">compute节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-8"><span class="nav-number">17.23.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE-etc-neutron-neutron-conf%E6%96%87%E4%BB%B6"><span class="nav-number">17.24.</span> <span class="nav-text">编辑配置&#x2F;etc&#x2F;neutron&#x2F;neutron.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEprovider%E7%BD%91%E7%BB%9C"><span class="nav-number">17.25.</span> <span class="nav-text">配置provider网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE-etc-neutron-plugins-ml2-linuxbridge-agent-ini%E6%96%87%E4%BB%B6"><span class="nav-number">17.26.</span> <span class="nav-text">编辑配置&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AESelf-service%E7%BD%91%E7%BB%9C-1"><span class="nav-number">17.27.</span> <span class="nav-text">配置Self-service网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE-etc-neutron-plugins-ml2-linuxbridge-agent-ini%E6%96%87%E4%BB%B6-1"><span class="nav-number">17.28.</span> <span class="nav-text">编辑配置&#x2F;etc&#x2F;neutron&#x2F;plugins&#x2F;ml2&#x2F;linuxbridge_agent.ini文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEnova%E9%85%8D%E7%BD%AE-etc-nova-nova-conf%E6%96%87%E4%BB%B6"><span class="nav-number">17.29.</span> <span class="nav-text">配置nova配置&#x2F;etc&#x2F;nova&#x2F;nova.conf文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-6"><span class="nav-number">17.30.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81-1"><span class="nav-number">17.31.</span> <span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85dashboard"><span class="nav-number">18.</span> <span class="nav-text">安装dashboard</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#controller%E8%8A%82%E7%82%B9-4"><span class="nav-number">18.1.</span> <span class="nav-text">controller节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85-9"><span class="nav-number">18.2.</span> <span class="nav-text">安装软件包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-etc-openstack-dashboard-local-settings"><span class="nav-number">18.3.</span> <span class="nav-text">编辑配置文件&#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-etc-httpd-conf-d-openstack-dashboard-conf"><span class="nav-number">18.4.</span> <span class="nav-text">编辑&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;openstack-dashboard.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-7"><span class="nav-number">18.5.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81-2"><span class="nav-number">18.6.</span> <span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">19.</span> <span class="nav-text">创建虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAprovider%E7%BD%91%E7%BB%9C"><span class="nav-number">19.1.</span> <span class="nav-text">创建provider网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E7%BD%91"><span class="nav-number">19.2.</span> <span class="nav-text">创建子网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BASelf-service%E7%BD%91%E7%BB%9C"><span class="nav-number">19.3.</span> <span class="nav-text">创建Self-service网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1"><span class="nav-number">19.4.</span> <span class="nav-text">创建路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%90%E7%BD%91%E6%8E%A5%E5%8F%A3"><span class="nav-number">19.5.</span> <span class="nav-text">创建子网接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E5%85%B3"><span class="nav-number">19.6.</span> <span class="nav-text">创建网关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B"><span class="nav-number">19.7.</span> <span class="nav-text">创建类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASelf-service%E7%BD%91%E7%BB%9C%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">19.8.</span> <span class="nav-text">创建一个Self-service网络的虚拟机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%88%9B%E5%BB%BA%E6%88%90%E5%8A%9F"><span class="nav-number">19.9.</span> <span class="nav-text">查看是否创建成功</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zerchin"
      src="/images/ghost_dead.jpg">
  <p class="site-author-name" itemprop="name">zerchin</p>
  <div class="site-description" itemprop="description">云原生技术</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">86</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:zerchin@163.com" title="E-Mail → mailto:zerchin@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </section>
      </div>
        <div class="back-to-top animated">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.zerchin.xyz/2018/09/04/CentOS7.5%E5%AE%89%E8%A3%85OpenStack_Rocky%E7%89%88%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ghost_dead.jpg">
      <meta itemprop="name" content="zerchin">
      <meta itemprop="description" content="云原生技术">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zerchin 云技术栈">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CentOS7.5安装OpenStack Rocky版本
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-04 18:20:21" itemprop="dateCreated datePublished" datetime="2018-09-04T18:20:21+00:00">2018-09-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-07-19 08:23:02" itemprop="dateModified" datetime="2022-07-19T08:23:02+00:00">2022-07-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/openstack/" itemprop="url" rel="index"><span itemprop="name">openstack</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>刚刚更新了版本，就忍不住想安装一下，因时间有限，只安装到了dashboari<br>搭建过程中，跟着官网走了遍流程，基本上没啥问题<br>建议还是跟着官网搭一遍会舒服很多 <a target="_blank" rel="noopener" href="https://docs.openstack.org/install-guide">https://docs.openstack.org/install-guide</a><br>因为是自己搭着玩，为了方便，所有关于密码的设置，都设置成000000</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><table>
<thead>
<tr>
<th>主机</th>
<th>系统</th>
<th>网卡1:eth0</th>
<th>网卡2:eth1</th>
</tr>
</thead>
<tbody><tr>
<td>controller</td>
<td>CentOS7.5</td>
<td>192.168.100.10</td>
<td>192.168.200.10</td>
</tr>
<tr>
<td>compute</td>
<td>CentOS7.5</td>
<td>192.168.100.20</td>
<td>192.168.200.20</td>
</tr>
</tbody></table>
<h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl restart network</span></span><br><span class="line"><span class="comment"># systemctl stop firewalld</span></span><br><span class="line"><span class="comment"># systemctl disable firewalld</span></span><br><span class="line"><span class="comment"># setenforce 0</span></span><br><span class="line"><span class="comment"># sed -i &#x27;s/=enforcing/=disabled/&#x27; /etc/selinux/config</span></span><br></pre></td></tr></table></figure>
<h2 id="更新软件包"><a href="#更新软件包" class="headerlink" title="更新软件包"></a>更新软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum upgrade -y</span></span><br></pre></td></tr></table></figure>
<h2 id="更新完成后重启系统"><a href="#更新完成后重启系统" class="headerlink" title="更新完成后重启系统"></a>更新完成后重启系统</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure>
<h2 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostnamectl set-hostname controller</span></span><br><span class="line"><span class="comment"># hostnamectl set-hostname compute</span></span><br></pre></td></tr></table></figure>
<h2 id="添加主机映射"><a href="#添加主机映射" class="headerlink" title="添加主机映射"></a>添加主机映射</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt;&gt; /etc/hosts</span></span><br><span class="line">192.168.100.10 controller</span><br><span class="line">192.168.100.20 compute</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h2 id="配置时间同步"><a href="#配置时间同步" class="headerlink" title="配置时间同步"></a>配置时间同步</h2><h3 id="controller节点"><a href="#controller节点" class="headerlink" title="controller节点"></a>controller节点</h3><h3 id="安装软件包"><a href="#安装软件包" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y chrony</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-chrony-conf文件"><a href="#编辑-etc-chrony-conf文件" class="headerlink" title="编辑/etc/chrony.conf文件"></a>编辑/etc/chrony.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server controller iburst</span><br><span class="line">allow 192.168.0.0/16</span><br></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start chronyd</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable chronyd</span></span><br></pre></td></tr></table></figure>
<h4 id="compute节点"><a href="#compute节点" class="headerlink" title="compute节点"></a>compute节点</h4><h3 id="安装软件包-1"><a href="#安装软件包-1" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]<span class="comment"># yum install -y chrony</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-chrony-conf文件-1"><a href="#编辑-etc-chrony-conf文件-1" class="headerlink" title="编辑/etc/chrony.conf文件"></a>编辑/etc/chrony.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server controller iburst</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]<span class="comment"># systemctl start chronyd</span></span><br><span class="line">[root@compute ~]<span class="comment"># systemctl enable chronyd</span></span><br></pre></td></tr></table></figure>
<h2 id="配置OpenStack-rocky的yum源文件"><a href="#配置OpenStack-rocky的yum源文件" class="headerlink" title="配置OpenStack-rocky的yum源文件"></a>配置OpenStack-rocky的yum源文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat &lt;&lt; EOF &gt;&gt; /etc/yum.repos.d/openstack.repo</span></span><br><span class="line">[openstack-rocky]</span><br><span class="line">name=openstack-rocky</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos/7/cloud/x86_64/openstack-rocky/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[qume-kvm]</span><br><span class="line">name=qemu-kvm</span><br><span class="line">baseurl= https://mirrors.aliyun.com/centos/7/virt/x86_64/kvm-common/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h2 id="安装OpenStack客户端和selinux服务"><a href="#安装OpenStack客户端和selinux服务" class="headerlink" title="安装OpenStack客户端和selinux服务"></a>安装OpenStack客户端和selinux服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y python-openstackclient openstack-selinux</span></span><br></pre></td></tr></table></figure>
<h2 id="安装数据库服务"><a href="#安装数据库服务" class="headerlink" title="安装数据库服务"></a>安装数据库服务</h2><h3 id="在controller节点安装数据库"><a href="#在controller节点安装数据库" class="headerlink" title="在controller节点安装数据库"></a>在controller节点安装数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y mariadb mariadb-server python2-PyMySQL</span></span><br></pre></td></tr></table></figure>
<h3 id="修改数据库配置文件"><a href="#修改数据库配置文件" class="headerlink" title="修改数据库配置文件"></a>修改数据库配置文件</h3><p>新建数据库配置文件/etc/my.cnf.d/openstack.cnf，添加以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">bind-address = 192.168.100.10</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br></pre></td></tr></table></figure>
<h3 id="启动数据库服务"><a href="#启动数据库服务" class="headerlink" title="启动数据库服务"></a>启动数据库服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl enable mariadb.service</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl start mariadb.service</span></span><br></pre></td></tr></table></figure>
<h3 id="设置数据库密码"><a href="#设置数据库密码" class="headerlink" title="设置数据库密码"></a>设置数据库密码</h3><p>运行mysql_secure_installation命令，创建数据库root密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysql_secure_installation</span></span><br><span class="line">NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB</span><br><span class="line">SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY!</span><br><span class="line">In order to <span class="built_in">log</span> into MariaDB to secure it, we<span class="string">&#x27;ll need the current</span></span><br><span class="line"><span class="string">password for the root user. If you&#x27;</span>ve just installed MariaDB, and</span><br><span class="line">you haven<span class="string">&#x27;t set the root password yet, the password will be blank,</span></span><br><span class="line"><span class="string">so you should just press enter here.</span></span><br><span class="line"><span class="string">Enter current password for root (enter for none):</span></span><br><span class="line"><span class="string">OK, successfully used password, moving on...</span></span><br><span class="line"><span class="string">Setting the root password ensures that nobody can log into the MariaDB</span></span><br><span class="line"><span class="string">root user without the proper authorisation.</span></span><br><span class="line"><span class="string">Set root password? [Y/n] y</span></span><br><span class="line"><span class="string">New password: ## 此处为root用户密码，这里设为000000</span></span><br><span class="line"><span class="string">Re-enter new password:</span></span><br><span class="line"><span class="string">Password updated successfully!</span></span><br><span class="line"><span class="string">Reloading privilege tables..</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">By default, a MariaDB installation has an anonymous user, allowing anyone</span></span><br><span class="line"><span class="string">to log into MariaDB without having to have a user account created for</span></span><br><span class="line"><span class="string">them. This is intended only for testing, and to make the installation</span></span><br><span class="line"><span class="string">go a bit smoother. You should remove them before moving into a</span></span><br><span class="line"><span class="string">production environment.</span></span><br><span class="line"><span class="string">Remove anonymous users? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">Normally, root should only be allowed to connect from &#x27;</span>localhost<span class="string">&#x27;. This</span></span><br><span class="line"><span class="string">ensures that someone cannot guess at the root password from the network.</span></span><br><span class="line"><span class="string">Disallow root login remotely? [Y/n] n</span></span><br><span class="line"><span class="string">... skipping.</span></span><br><span class="line"><span class="string">By default, MariaDB comes with a database named &#x27;</span><span class="built_in">test</span><span class="string">&#x27; that anyone can</span></span><br><span class="line"><span class="string">access. This is also intended only for testing, and should be removed</span></span><br><span class="line"><span class="string">before moving into a production environment.</span></span><br><span class="line"><span class="string">Remove test database and access to it? [Y/n] y</span></span><br><span class="line"><span class="string">- Dropping test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">- Removing privileges on test database...</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">Reloading the privilege tables will ensure that all changes made so far</span></span><br><span class="line"><span class="string">will take effect immediately.</span></span><br><span class="line"><span class="string">Reload privilege tables now? [Y/n] y</span></span><br><span class="line"><span class="string">... Success!</span></span><br><span class="line"><span class="string">Cleaning up...</span></span><br><span class="line"><span class="string">All done! If you&#x27;</span>ve completed all of the above steps, your MariaDB</span><br><span class="line">installation should now be secure.</span><br><span class="line">Thanks <span class="keyword">for</span> using MariaDB!</span><br></pre></td></tr></table></figure>
<h2 id="安装消息队列服务"><a href="#安装消息队列服务" class="headerlink" title="安装消息队列服务"></a>安装消息队列服务</h2><h3 id="在controller节点安装rabbitmq-server"><a href="#在controller节点安装rabbitmq-server" class="headerlink" title="在controller节点安装rabbitmq-server"></a>在controller节点安装rabbitmq-server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y rabbitmq-server -y</span></span><br></pre></td></tr></table></figure>
<h3 id="启动消息队列服务"><a href="#启动消息队列服务" class="headerlink" title="启动消息队列服务"></a>启动消息队列服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start rabbitmq-server.service</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable rabbitmq-server.service</span></span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/rabbitmq-server.service to</span><br><span class="line">/usr/lib/systemd/system/rabbitmq-server.service.</span><br></pre></td></tr></table></figure>
<h3 id="添加openstack用户"><a href="#添加openstack用户" class="headerlink" title="添加openstack用户"></a>添加openstack用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># rabbitmqctl add_user openstack 000000</span></span><br><span class="line">Creating user <span class="string">&quot;openstack&quot;</span> ...</span><br></pre></td></tr></table></figure>
<h3 id="设置openstack用户最高权限"><a href="#设置openstack用户最高权限" class="headerlink" title="设置openstack用户最高权限"></a>设置openstack用户最高权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span><br><span class="line">Setting permissions <span class="keyword">for</span> user <span class="string">&quot;openstack&quot;</span> <span class="keyword">in</span> vhost <span class="string">&quot;/&quot;</span> ...</span><br></pre></td></tr></table></figure>
<h2 id="安装memcached-服务"><a href="#安装memcached-服务" class="headerlink" title="安装memcached 服务"></a>安装memcached 服务</h2><h3 id="在controller节点上安装memcached"><a href="#在controller节点上安装memcached" class="headerlink" title="在controller节点上安装memcached"></a>在controller节点上安装memcached</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y memcached</span></span><br></pre></td></tr></table></figure>
<h3 id="修改memcached配置文件"><a href="#修改memcached配置文件" class="headerlink" title="修改memcached配置文件"></a>修改memcached配置文件</h3><p>编辑/etc/sysconfig/memcached，修改以下内容<br>修改OPTIONS=”-l 127.0.0.1,::1”为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS=<span class="string">&quot;-l 127.0.0.1,::1,controller&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="启动memcached服务"><a href="#启动memcached服务" class="headerlink" title="启动memcached服务"></a>启动memcached服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start memcached.service</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable memcached.service</span></span><br></pre></td></tr></table></figure>
<h2 id="安装etcd服务"><a href="#安装etcd服务" class="headerlink" title="安装etcd服务"></a>安装etcd服务</h2><h3 id="在controller节点上安装etcd服务"><a href="#在controller节点上安装etcd服务" class="headerlink" title="在controller节点上安装etcd服务"></a>在controller节点上安装etcd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install etcd -y</span></span><br></pre></td></tr></table></figure>
<h3 id="修改etcd配置文件，使其他节点能够访问"><a href="#修改etcd配置文件，使其他节点能够访问" class="headerlink" title="修改etcd配置文件，使其他节点能够访问"></a>修改etcd配置文件，使其他节点能够访问</h3><p>编辑/etc/etcd/etcd.conf，在各自的位置修改以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[Member]</span></span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_PEER_URLS=<span class="string">&quot;http://192.168.100.10:2380&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://192.168.100.10:2379&quot;</span></span><br><span class="line">ETCD_NAME=<span class="string">&quot;controller&quot;</span></span><br><span class="line"><span class="comment">#[Clustering]</span></span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=<span class="string">&quot;http://192.168.100.10:2380&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://192.168.100.10:2379&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER=<span class="string">&quot;controller=http://192.168.100.10:2380&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster-01&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="启动etcd服务"><a href="#启动etcd服务" class="headerlink" title="启动etcd服务"></a>启动etcd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start etcd</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable etcd</span></span><br></pre></td></tr></table></figure>
<p>（在我想查看集群的时候，报错了，虽然好像无关）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># etcdctl cluster-health</span></span><br><span class="line">cluster may be unhealthy: failed to list members</span><br><span class="line">Error: client: etcd cluster is unavailable or misconfigured; error <span class="comment">#0: dial tcp</span></span><br><span class="line">127.0.0.1:4001: getsockopt: connection refused</span><br><span class="line">; error <span class="comment">#1: dial tcp 127.0.0.1:2379: getsockopt: connection refused</span></span><br><span class="line">error <span class="comment">#0: dial tcp 127.0.0.1:4001: getsockopt: connection refused</span></span><br><span class="line">error <span class="comment">#1: dial tcp 127.0.0.1:2379: getsockopt: connection refused</span></span><br></pre></td></tr></table></figure>
<h2 id="安装keystone服务"><a href="#安装keystone服务" class="headerlink" title="安装keystone服务"></a>安装keystone服务</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 9</span><br><span class="line">Server version: 10.1.20-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE keystone;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO</span><br><span class="line"><span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>\</span><br><span class="line">-&gt; IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON keystone.* TO <span class="string">&#x27;keystone&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="安装软件包-2"><a href="#安装软件包-2" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install openstack-keystone httpd mod_wsgi -y</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-keystone-keystone-conf"><a href="#编辑配置文件-etc-keystone-keystone-conf" class="headerlink" title="编辑配置文件/etc/keystone/keystone.conf"></a>编辑配置文件/etc/keystone/keystone.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://keystone:000000@controller/keystone</span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure>
<h3 id="同步数据库"><a href="#同步数据库" class="headerlink" title="同步数据库"></a>同步数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span></span><br></pre></td></tr></table></figure>
<h3 id="初始化fernet-key库"><a href="#初始化fernet-key库" class="headerlink" title="初始化fernet key库"></a>初始化fernet key库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># keystone-manage fernet_setup --keystone-user keystone</span></span><br><span class="line">--keystone-group keystone</span><br><span class="line">[root@controller ~]<span class="comment"># keystone-manage credential_setup --keystone-user</span></span><br><span class="line">keystone --keystone-group keystone</span><br></pre></td></tr></table></figure>
<h3 id="引导身份认证"><a href="#引导身份认证" class="headerlink" title="引导身份认证"></a>引导身份认证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># keystone-manage bootstrap --bootstrap-password 000000 \</span></span><br><span class="line">--bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">--bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>
<h3 id="编辑httpd配置文件-etc-httpd-conf-httpd-conf"><a href="#编辑httpd配置文件-etc-httpd-conf-httpd-conf" class="headerlink" title="编辑httpd配置文件/etc/httpd/conf/httpd.conf"></a>编辑httpd配置文件/etc/httpd/conf/httpd.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerName controller</span><br></pre></td></tr></table></figure>
<h3 id="创建文件链接"><a href="#创建文件链接" class="headerlink" title="创建文件链接"></a>创建文件链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># ln -s /usr/share/keystone/wsgi-keystone.conf</span></span><br><span class="line">/etc/httpd/conf.d/</span><br></pre></td></tr></table></figure>
<h3 id="启动httpd服务"><a href="#启动httpd服务" class="headerlink" title="启动httpd服务"></a>启动httpd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start httpd</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable httpd</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service</span><br><span class="line">to /usr/lib/systemd/system/httpd.service.</span><br></pre></td></tr></table></figure>
<h3 id="编写环境变量脚本admin-openrc"><a href="#编写环境变量脚本admin-openrc" class="headerlink" title="编写环境变量脚本admin-openrc"></a>编写环境变量脚本admin-openrc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_PASSWORD=000000</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="built_in">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="built_in">export</span> OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line"><span class="built_in">export</span> OS_IDENTITY_API_VERSION=3</span><br><span class="line"><span class="built_in">export</span> OS_IMAGE_API_VERSION=2</span><br></pre></td></tr></table></figure>
<h3 id="创建service项目"><a href="#创建service项目" class="headerlink" title="创建service项目"></a>创建service项目</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack project create --domain default \</span></span><br><span class="line">&gt; --description <span class="string">&quot;Service Project&quot;</span> service</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Service Project |</span><br><span class="line">| domain_id | default |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 617e64ff415b45ef975b8faf3d5207dd |</span><br><span class="line">| is_domain | False |</span><br><span class="line">| name | service |</span><br><span class="line">| parent_id | default |</span><br><span class="line">| tags | [] |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line"><span class="comment">### 验证</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack user list</span></span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID | Name |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| 5238d646322346be9e3f9750422bcf4d | admin |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack token issue</span></span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| expires | 2018-09-03T14:30:02+0000 |</span><br><span class="line">| id |</span><br><span class="line">gAAAAABbjTdauHEUmA_PQ1deLrPsMXiITgOyGu325OkqBYxhwYK5pS5A217gFJcnt_T50T6vfVXDTPR1HJ-HM7_Dlmm5GbPBAe_4KuWygSebGPAU7_NQoZT5gH0gjtyW5aF0mw-dyqvVykcXQWeeZ_q15HOjUZ2ujn_O2GYfjFhUmhaagrUvYys</span><br><span class="line">|</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| user_id | 5238d646322346be9e3f9750422bcf4d |</span><br><span class="line">+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="glance安装"><a href="#glance安装" class="headerlink" title="glance安装"></a>glance安装</h2><h3 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 17</span><br><span class="line">Server version: 10.1.20-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE glance;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">&#x27;glance&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED</span><br><span class="line">BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="创建用户、服务等"><a href="#创建用户、服务等" class="headerlink" title="创建用户、服务等"></a>创建用户、服务等</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># source admin-openrc</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack user create --domain default --password-prompt</span></span><br><span class="line">glance</span><br><span class="line">User Password:000000</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id | default |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 73e040b3ca46485dad6ce8c49bfbd8e2 |</span><br><span class="line">| name | glance |</span><br><span class="line">| options | &#123;&#125; |</span><br><span class="line">| password_expires_at | None |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack role add --project service --user glance admin</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack service create --name glance \</span></span><br><span class="line">&gt; --description <span class="string">&quot;OpenStack Image&quot;</span> image</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Image |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | e61eb0929ae842e48c2b1f029e67578b |</span><br><span class="line">| name | glance |</span><br><span class="line">| <span class="built_in">type</span> | image |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; image public http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | ee8719ec7a5547fbaa1ca685fca1d8e0 |</span><br><span class="line">| interface | public |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | e61eb0929ae842e48c2b1f029e67578b |</span><br><span class="line">| service_name | glance |</span><br><span class="line">| service_type | image |</span><br><span class="line">| url | http://controller:9292 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; image internal http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 27379aa551644711b2f3568a5387e003 |</span><br><span class="line">| interface | internal |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | e61eb0929ae842e48c2b1f029e67578b |</span><br><span class="line">| service_name | glance |</span><br><span class="line">| service_type | image |</span><br><span class="line">| url | http://controller:9292 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; image admin http://controller:9292</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | b9f6c2bfee5f46bf8d654336094c4360 |</span><br><span class="line">| interface | admin |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | e61eb0929ae842e48c2b1f029e67578b |</span><br><span class="line">| service_name | glance |</span><br><span class="line">| service_type | image |</span><br><span class="line">| url | http://controller:9292 |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="安装软件包-3"><a href="#安装软件包-3" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y openstack-glance</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-glance-glance-api-conf"><a href="#编辑配置文件-etc-glance-glance-api-conf" class="headerlink" title="编辑配置文件/etc/glance/glance-api.conf"></a>编辑配置文件/etc/glance/glance-api.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://glance:000000@controller/glance</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = 000000</span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br><span class="line">[glance_store]</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = /var/lib/glance/images/</span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-glance-glance-registry-conf"><a href="#编辑配置文件-etc-glance-glance-registry-conf" class="headerlink" title="编辑配置文件/etc/glance/glance-registry.conf"></a>编辑配置文件/etc/glance/glance-registry.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://glance:000000@controller/glance</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = 000000</span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br></pre></td></tr></table></figure>
<h3 id="同步数据库-1"><a href="#同步数据库-1" class="headerlink" title="同步数据库"></a>同步数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;glance-manage db_sync&quot; glance</span></span><br><span class="line">/usr/lib/python2.7/site-packages/oslo_db/sqlalchemy/enginefacade.py:1352:</span><br><span class="line">OsloDBDeprecationWarning: EngineFacade is deprecated; please use</span><br><span class="line">oslo_db.sqlalchemy.enginefacade</span><br><span class="line">expire_on_commit=expire_on_commit, \_conf=conf)</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade -&gt; liberty, liberty initial</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade liberty -&gt; mitaka01, add index</span><br><span class="line">on created_at and updated_at columns of <span class="string">&#x27;images&#x27;</span> table</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade mitaka01 -&gt; mitaka02, update</span><br><span class="line">metadef os_nova_server</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade mitaka02 -&gt; ocata_expand01,</span><br><span class="line">add visibility to images</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade ocata_expand01 -&gt;</span><br><span class="line">pike_expand01, empty expand <span class="keyword">for</span> symmetry with pike_contract01</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade pike_expand01 -&gt;</span><br><span class="line">queens_expand01</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade queens_expand01 -&gt;</span><br><span class="line">rocky_expand01, add os_hidden column to images table</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade rocky_expand01 -&gt;</span><br><span class="line">rocky_expand02, add os_hash_algo and os_hash_value columns to images table</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Upgraded database to: rocky_expand02, current revision(s): rocky_expand02</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Database migration is up to date. No migration needed.</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade mitaka02 -&gt; ocata_contract01,</span><br><span class="line">remove is_public from images</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade ocata_contract01 -&gt;</span><br><span class="line">pike_contract01, drop glare artifacts tables</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade pike_contract01 -&gt;</span><br><span class="line">queens_contract01</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade queens_contract01 -&gt;</span><br><span class="line">rocky_contract01</span><br><span class="line">INFO [alembic.runtime.migration] Running upgrade rocky_contract01 -&gt;</span><br><span class="line">rocky_contract02</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Upgraded database to: rocky_contract02, current revision(s): rocky_contract02</span><br><span class="line">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span><br><span class="line">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span><br><span class="line">Database is synced successfully.</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-2"><a href="#启动服务-2" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start openstack-glance-api.service</span></span><br><span class="line">openstack-glance-registry.service</span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable openstack-glance-api.service</span></span><br><span class="line">openstack-glance-registry.service</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-glance-api.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-glance-api.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-glance-registry.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-glance-registry.service.</span><br></pre></td></tr></table></figure>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment">#. admin-openrc</span></span><br><span class="line">[root@controller ~]<span class="comment"># wget</span></span><br><span class="line">http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img</span><br><span class="line">[root@controller ~]<span class="comment"># openstack image create &quot;cirros&quot; --file</span></span><br><span class="line">cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare</span><br><span class="line">--public</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| checksum | ee1eca47dc88f4879d8a229cc70a07c6 |</span><br><span class="line">| container_format | bare |</span><br><span class="line">| created_at | 2018-09-03T13:49:12Z |</span><br><span class="line">| disk_format | qcow2 |</span><br><span class="line">| file | /v2/images/8faa9dc9-7f29-4570-ae87-9bab0d01aa63/file |</span><br><span class="line">| id | 8faa9dc9-7f29-4570-ae87-9bab0d01aa63 |</span><br><span class="line">| min_disk | 0 |</span><br><span class="line">| min_ram | 0 |</span><br><span class="line">| name | cirros |</span><br><span class="line">| owner | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| properties | os_hash_algo=<span class="string">&#x27;sha512&#x27;</span>,</span><br><span class="line">os_hash_value=<span class="string">&#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;</span>,</span><br><span class="line">os_hidden=<span class="string">&#x27;False&#x27;</span> |</span><br><span class="line">| protected | False |</span><br><span class="line">| schema | /v2/schemas/image |</span><br><span class="line">| size | 13287936 |</span><br><span class="line">| status | active |</span><br><span class="line">| tags | |</span><br><span class="line">| updated_at | 2018-09-03T13:49:13Z |</span><br><span class="line">| virtual_size | None |</span><br><span class="line">| visibility | public |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack image list</span></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID | Name | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| 8faa9dc9-7f29-4570-ae87-9bab0d01aa63 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>
<h2 id="安装nova服务"><a href="#安装nova服务" class="headerlink" title="安装nova服务"></a>安装nova服务</h2><h3 id="controller节点-1"><a href="#controller节点-1" class="headerlink" title="controller节点"></a>controller节点</h3><h3 id="创建数据库-2"><a href="#创建数据库-2" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -u root -p000000</span></span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_api;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE placement;</span><br><span class="line">Grant proper access to the databases:</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">\</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">&#x27;nova&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON placement.* TO</span><br><span class="line"><span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON placement.* TO <span class="string">&#x27;placement&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建相关用户、服务"><a href="#创建相关用户、服务" class="headerlink" title="创建相关用户、服务"></a>创建相关用户、服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack user create --domain default --password-prompt</span></span><br><span class="line">nova</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id | default |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | ea181b4b1de3430e8646795f133ad8fe |</span><br><span class="line">| name | nova |</span><br><span class="line">| options | &#123;&#125; |</span><br><span class="line">| password_expires_at | None |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack role add --project service --user nova admin</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack service create --name nova \</span></span><br><span class="line">&gt; --description <span class="string">&quot;OpenStack Compute&quot;</span> compute</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 52a1c2cd42fb45df9ab5ac0782faae4e |</span><br><span class="line">| name | nova |</span><br><span class="line">| <span class="built_in">type</span> | compute |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; compute public http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 4f009d7ff354428ab5dafadf0ed0095d |</span><br><span class="line">| interface | public |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | 52a1c2cd42fb45df9ab5ac0782faae4e |</span><br><span class="line">| service_name | nova |</span><br><span class="line">| service_type | compute |</span><br><span class="line">| url | http://controller:8774/v2.1 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; compute internal http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 5191feea83ba4a17b79a4a7d83f85651 |</span><br><span class="line">| interface | internal |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | 52a1c2cd42fb45df9ab5ac0782faae4e |</span><br><span class="line">| service_name | nova |</span><br><span class="line">| service_type | compute |</span><br><span class="line">| url | http://controller:8774/v2.1 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; compute admin http://controller:8774/v2.1</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 2fa5622c3f134f0ba8215baab1bad899 |</span><br><span class="line">| interface | admin |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | 52a1c2cd42fb45df9ab5ac0782faae4e |</span><br><span class="line">| service_name | nova |</span><br><span class="line">| service_type | compute |</span><br><span class="line">| url | http://controller:8774/v2.1 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack user create --domain default --password-prompt</span></span><br><span class="line">placement</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id | default |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | ab7f16a5e08c4140b396f27f8fc75f69 |</span><br><span class="line">| name | placement |</span><br><span class="line">| options | &#123;&#125; |</span><br><span class="line">| password_expires_at | None |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack role add --project service --user placement</span></span><br><span class="line">admin</span><br><span class="line">[root@controller ~]<span class="comment"># openstack service create --name placement \</span></span><br><span class="line">&gt; --description <span class="string">&quot;Placement API&quot;</span> placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | be7f6d35fbd448c79b04d816df68e2d1 |</span><br><span class="line">| name | placement |</span><br><span class="line">| <span class="built_in">type</span> | placement |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; placement public http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 443ad9ccf38c4930be407e6c755c37fd |</span><br><span class="line">| interface | public |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | be7f6d35fbd448c79b04d816df68e2d1 |</span><br><span class="line">| service_name | placement |</span><br><span class="line">| service_type | placement |</span><br><span class="line">| url | http://controller:8778 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; placement internal http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 8827a5950f1a49fbb77267812daae462 |</span><br><span class="line">| interface | internal |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | be7f6d35fbd448c79b04d816df68e2d1 |</span><br><span class="line">| service_name | placement |</span><br><span class="line">| service_type | placement |</span><br><span class="line">| url | http://controller:8778 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; placement admin http://controller:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 2e5bb38b860643f1b2bf7c2cd6ff6447 |</span><br><span class="line">| interface | admin |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | be7f6d35fbd448c79b04d816df68e2d1 |</span><br><span class="line">| service_name | placement |</span><br><span class="line">| service_type | placement |</span><br><span class="line">| url | http://controller:8778 |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="安装软件包-4"><a href="#安装软件包-4" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install openstack-nova-api openstack-nova-conductor</span></span><br><span class="line">\</span><br><span class="line">openstack-nova-console openstack-nova-novncproxy \</span><br><span class="line">openstack-nova-scheduler openstack-nova-placement-api -y</span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-nova-nova-conf"><a href="#编辑配置文件-etc-nova-nova-conf" class="headerlink" title="编辑配置文件/etc/nova/nova.conf"></a>编辑配置文件/etc/nova/nova.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">[api_database]</span><br><span class="line">connection = mysql+pymysql://nova:000000@controller/nova_api</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://nova:000000@controller/nova</span><br><span class="line">[placement_database]</span><br><span class="line">connection = mysql+pymysql://placement:000000@controller/placement</span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:000000@controller</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 000000</span><br><span class="line">[DEFAULT]</span><br><span class="line">my_ip = 192.168.100.10</span><br><span class="line">[DEFAULT]</span><br><span class="line">use_neutron = <span class="literal">true</span></span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">server_listen = <span class="variable">$my_ip</span></span><br><span class="line">server_proxyclient_address = <span class="variable">$my_ip</span></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = 000000</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-httpd-conf-d-00-nova-placement-api-conf，添加以下内容"><a href="#编辑-etc-httpd-conf-d-00-nova-placement-api-conf，添加以下内容" class="headerlink" title="编辑/etc/httpd/conf.d/00-nova-placement-api.conf，添加以下内容"></a>编辑/etc/httpd/conf.d/00-nova-placement-api.conf，添加以下内容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory /usr/bin&gt;</span><br><span class="line">&lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">Require all granted</span><br><span class="line">&lt;/IfVersion&gt;</span><br><span class="line">&lt;IfVersion &lt; 2.4&gt;</span><br><span class="line">Order allow,deny</span><br><span class="line">Allow from all</span><br><span class="line">&lt;/IfVersion&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>
<h3 id="重启httpd服务"><a href="#重启httpd服务" class="headerlink" title="重启httpd服务"></a>重启httpd服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl restart httpd</span></span><br></pre></td></tr></table></figure>
<h3 id="同步nova-api数据库"><a href="#同步nova-api数据库" class="headerlink" title="同步nova_api数据库"></a>同步nova_api数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova</span></span><br></pre></td></tr></table></figure>
<h3 id="注册cell0数据库"><a href="#注册cell0数据库" class="headerlink" title="注册cell0数据库"></a>注册cell0数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova</span></span><br></pre></td></tr></table></figure>
<h3 id="创建cell1单元"><a href="#创建cell1单元" class="headerlink" title="创建cell1单元"></a>创建cell1单元</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell</span></span><br><span class="line">--name=cell1 --verbose<span class="string">&quot; nova</span></span><br><span class="line"><span class="string">54e6c270-7390-4390-8702-02b72874c5a7</span></span><br></pre></td></tr></table></figure>
<h3 id="同步nova数据库"><a href="#同步nova数据库" class="headerlink" title="同步nova数据库"></a>同步nova数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage db sync&quot; nova</span></span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:166: Warning: (1831,</span><br><span class="line">u<span class="string">&#x27;Duplicate index</span></span><br><span class="line"><span class="string">\`block_device_mapping_instance_uuid_virtual_name_device_name_idx\`. This is</span></span><br><span class="line"><span class="string">deprecated and will be disallowed in a future release.&#x27;</span>)</span><br><span class="line">result = self._query(query)</span><br><span class="line">/usr/lib/python2.7/site-packages/pymysql/cursors.py:166: Warning: (1831,</span><br><span class="line">u<span class="string">&#x27;Duplicate index \`uniq_instances0uuid\`. This is deprecated and will be</span></span><br><span class="line"><span class="string">disallowed in a future release.&#x27;</span>)</span><br><span class="line">result = self._query(query)</span><br></pre></td></tr></table></figure>
<h3 id="验证cell0和cell1注册成功"><a href="#验证cell0和cell1注册成功" class="headerlink" title="验证cell0和cell1注册成功"></a>验证cell0和cell1注册成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span></span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">| Name | UUID | Transport URL | Database Connection | Disabled |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br><span class="line">| cell0 | 00000000-0000-0000-0000-000000000000 | none:/ |</span><br><span class="line">mysql+pymysql://nova:****@controller/nova_cell0 | False |</span><br><span class="line">| cell1 | 54e6c270-7390-4390-8702-02b72874c5a7 |</span><br><span class="line">rabbit://openstack:****@controller |</span><br><span class="line">mysql+pymysql://nova:****@controller/nova | False |</span><br><span class="line">+-------+--------------------------------------+------------------------------------+-------------------------------------------------+----------+</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-3"><a href="#启动服务-3" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start openstack-nova-api.service \</span></span><br><span class="line">openstack-nova-scheduler.service openstack-nova-conductor.service \</span><br><span class="line">openstack-nova-novncproxy.service openstack-nova-conductor</span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable openstack-nova-api.service \</span></span><br><span class="line">openstack-nova-scheduler.service openstack-nova-conductor.service \</span><br><span class="line">openstack-nova-novncproxy.service openstack-nova-conductor</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-nova-api.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-nova-api.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-nova-scheduler.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-nova-scheduler.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-nova-conductor.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-nova-conductor.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-nova-novncproxy.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-nova-novncproxy.service.</span><br></pre></td></tr></table></figure>
<p>官网没有启动nova-conductor服务</p>
<h3 id="compute节点-1"><a href="#compute节点-1" class="headerlink" title="compute节点"></a>compute节点</h3><h3 id="安装软件包-5"><a href="#安装软件包-5" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]<span class="comment"># yum install openstack-nova-compute -y</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-nova-nova-conf-1"><a href="#编辑配置文件-etc-nova-nova-conf-1" class="headerlink" title="编辑配置文件/etc/nova/nova.conf"></a>编辑配置文件/etc/nova/nova.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:000000@controller</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 000000</span><br><span class="line">[DEFAULT]</span><br><span class="line">my_ip = 192.168.100.20</span><br><span class="line">[DEFAULT]</span><br><span class="line">use_neutron = <span class="literal">true</span></span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">server_proxyclient_address = <span class="variable">$my_ip</span></span><br><span class="line">novncproxy_base_url = http:// 192.168.100.10:6080/vnc_auto.html</span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = 000000</span><br></pre></td></tr></table></figure>
<h3 id="检查是否支持虚拟化"><a href="#检查是否支持虚拟化" class="headerlink" title="检查是否支持虚拟化"></a>检查是否支持虚拟化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo</span></span><br></pre></td></tr></table></figure>
<p>如果等于0，则要在/etc/nova/nova.conf的[libvirt]下添加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[libvirt]</span><br><span class="line">virt_type = qemu</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-4"><a href="#启动服务-4" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~] <span class="comment"># systemctl start libvirtd.service</span></span><br><span class="line">openstack-nova-compute.service</span><br><span class="line">[root@compute ~] <span class="comment"># systemctl enable libvirtd.service</span></span><br><span class="line">openstack-nova-compute.service</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to</span><br><span class="line">/usr/lib/systemd/system/openstack-nova-compute.service.</span><br></pre></td></tr></table></figure>
<h3 id="controller节点-2"><a href="#controller节点-2" class="headerlink" title="controller节点"></a>controller节点</h3><h3 id="确认数据库中有计算节点"><a href="#确认数据库中有计算节点" class="headerlink" title="确认数据库中有计算节点"></a>确认数据库中有计算节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># . admin-openrc</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack compute service list --service nova-compute</span></span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary | Host | Zone | Status | State | Updated At |</span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br><span class="line">| 6 | nova-compute | compute | nova | enabled | up |</span><br><span class="line">2018-09-03T14:16:10.000000 |</span><br><span class="line">+----+--------------+---------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="发现计算节点"><a href="#发现计算节点" class="headerlink" title="发现计算节点"></a>发现计算节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts</span></span><br><span class="line">--verbose<span class="string">&quot; nova</span></span><br><span class="line"><span class="string">Found 2 cell mappings.</span></span><br><span class="line"><span class="string">Skipping cell0 since it does not contain hosts.</span></span><br><span class="line"><span class="string">Getting computes from cell &#x27;cell1&#x27;: 54e6c270-7390-4390-8702-02b72874c5a7</span></span><br><span class="line"><span class="string">Checking host mapping for compute host &#x27;compute&#x27;:</span></span><br><span class="line"><span class="string">39d80423-6001-4036-a546-5287c1e93ec5</span></span><br><span class="line"><span class="string">Creating host mapping for compute host &#x27;compute&#x27;:</span></span><br><span class="line"><span class="string">39d80423-6001-4036-a546-5287c1e93ec5</span></span><br><span class="line"><span class="string">Found 1 unmapped computes in cell: 54e6c270-7390-4390-8702-02b72874c5a7</span></span><br></pre></td></tr></table></figure>
<p>如果想要自动发现新compute节点，可以在/etc/nova/nova.conf的[scheduler]下添加以下参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[scheduler]</span><br><span class="line">discover_hosts_in_cells_interval = 300</span><br></pre></td></tr></table></figure>
<h2 id="安装neutron服务"><a href="#安装neutron服务" class="headerlink" title="安装neutron服务"></a>安装neutron服务</h2><h3 id="controller节点-3"><a href="#controller节点-3" class="headerlink" title="controller节点"></a>controller节点</h3><h3 id="创建数据库-3"><a href="#创建数据库-3" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># mysql -uroot -p000000</span></span><br><span class="line">MariaDB [(none)] CREATE DATABASE neutron;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">\</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">&#x27;neutron&#x27;</span>@<span class="string">&#x27;%&#x27;</span> \</span><br><span class="line">IDENTIFIED BY <span class="string">&#x27;000000&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建用户、服务"><a href="#创建用户、服务" class="headerlink" title="创建用户、服务"></a>创建用户、服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack user create --domain default --password-prompt</span></span><br><span class="line">neutron</span><br><span class="line">User Password:</span><br><span class="line">Repeat User Password:</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id | default |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | d5b2036ead024ac0b09d3cf4c1b00e7c |</span><br><span class="line">| name | neutron |</span><br><span class="line">| options | &#123;&#125; |</span><br><span class="line">| password_expires_at | None |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack role add --project service --user neutron</span></span><br><span class="line">admin</span><br><span class="line">[root@controller ~]<span class="comment"># openstack service create --name neutron \</span></span><br><span class="line">&gt; --description <span class="string">&quot;OpenStack Networking&quot;</span> network</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Networking |</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | bfad907188c74a6f99120124b36b5113 |</span><br><span class="line">| name | neutron |</span><br><span class="line">| <span class="built_in">type</span> | network |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; network public http://controller:9696</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | bcd2134aab2d4202aa8ca0ca0de32d5a |</span><br><span class="line">| interface | public |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | bfad907188c74a6f99120124b36b5113 |</span><br><span class="line">| service_name | neutron |</span><br><span class="line">| service_type | network |</span><br><span class="line">| url | http://controller:9696 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; network internal http://controller:9696</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | 3ca0c46da89749cfba9b0f117e3ac201 |</span><br><span class="line">| interface | internal |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | bfad907188c74a6f99120124b36b5113 |</span><br><span class="line">| service_name | neutron |</span><br><span class="line">| service_type | network |</span><br><span class="line">| url | http://controller:9696 |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack endpoint create --region RegionOne \</span></span><br><span class="line">&gt; network admin http://controller:9696</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled | True |</span><br><span class="line">| id | cf69a76a963b41e0a0dd327072c3b5e4 |</span><br><span class="line">| interface | admin |</span><br><span class="line">| region | RegionOne |</span><br><span class="line">| region_id | RegionOne |</span><br><span class="line">| service_id | bfad907188c74a6f99120124b36b5113 |</span><br><span class="line">| service_name | neutron |</span><br><span class="line">| service_type | network |</span><br><span class="line">| url | http://controller:9696 |</span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="配置provider-network网络"><a href="#配置provider-network网络" class="headerlink" title="配置provider network网络"></a>配置provider network网络</h3><h3 id="安装软件包-6"><a href="#安装软件包-6" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install openstack-neutron openstack-neutron-ml2 \</span></span><br><span class="line">openstack-neutron-linuxbridge ebtables -y</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-neutron-conf配置文件"><a href="#编辑-etc-neutron-neutron-conf配置文件" class="headerlink" title="编辑/etc/neutron/neutron.conf配置文件"></a>编辑/etc/neutron/neutron.conf配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://neutron:000000@controller/neutron</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:000000@controller</span><br><span class="line">[DEFAULT]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = 000000</span><br><span class="line">[DEFAULT]</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[nova]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 000000</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-neutron-plugins-ml2-ml2-conf-ini"><a href="#编辑配置文件-etc-neutron-plugins-ml2-ml2-conf-ini" class="headerlink" title="编辑配置文件/etc/neutron/plugins/ml2/ml2_conf.ini"></a>编辑配置文件/etc/neutron/plugins/ml2/ml2_conf.ini</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">[ml2]</span><br><span class="line">tenant_network_types =</span><br><span class="line">[ml2]</span><br><span class="line">mechanism_drivers = linuxbridge</span><br><span class="line">[ml2]</span><br><span class="line">extension_drivers = port_security</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-plugins-ml2-linuxbridge-agent-ini配置文件"><a href="#编辑-etc-neutron-plugins-ml2-linuxbridge-agent-ini配置文件" class="headerlink" title="编辑/etc/neutron/plugins/ml2/linuxbridge_agent.ini配置文件"></a>编辑/etc/neutron/plugins/ml2/linuxbridge_agent.ini配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-neutron-dhcp-agent-ini"><a href="#编辑配置文件-etc-neutron-dhcp-agent-ini" class="headerlink" title="编辑配置文件/etc/neutron/dhcp_agent.ini"></a>编辑配置文件/etc/neutron/dhcp_agent.ini</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="配置Self-service网络"><a href="#配置Self-service网络" class="headerlink" title="配置Self-service网络"></a>配置Self-service网络</h3><h3 id="安装软件包-7"><a href="#安装软件包-7" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install openstack-neutron openstack-neutron-ml2 \</span></span><br><span class="line">openstack-neutron-linuxbridge ebtables -y</span><br></pre></td></tr></table></figure>
<h3 id="配置-etc-neutron-neutron-conf文件"><a href="#配置-etc-neutron-neutron-conf文件" class="headerlink" title="配置/etc/neutron/neutron.conf文件"></a>配置/etc/neutron/neutron.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://neutron:000000@controller/neutron</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins = router</span><br><span class="line">allow_overlapping_ips = <span class="literal">true</span></span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:000000@controller</span><br><span class="line">[DEFAULT]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = 000000</span><br><span class="line">[DEFAULT]</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[nova]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = 000000</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-plugins-ml2-ml2-conf-ini文件"><a href="#编辑-etc-neutron-plugins-ml2-ml2-conf-ini文件" class="headerlink" title="编辑/etc/neutron/plugins/ml2/ml2_conf.ini文件"></a>编辑/etc/neutron/plugins/ml2/ml2_conf.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan,vxlan</span><br><span class="line">[ml2]</span><br><span class="line">tenant_network_types = vxlan</span><br><span class="line">[ml2]</span><br><span class="line">mechanism_drivers = linuxbridge,l2population</span><br><span class="line">[ml2]</span><br><span class="line">extension_drivers = port_security</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[ml2_type_vxlan]</span><br><span class="line">vni_ranges = 1:1000</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件"><a href="#编辑-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件" class="headerlink" title="编辑/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件"></a>编辑/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">true</span></span><br><span class="line">local_ip = 192.168.200.10</span><br><span class="line">l2_population = <span class="literal">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-l3-agent-ini文件"><a href="#编辑-etc-neutron-l3-agent-ini文件" class="headerlink" title="编辑/etc/neutron/l3_agent.ini文件"></a>编辑/etc/neutron/l3_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-dhcp-agent-ini文件"><a href="#编辑-etc-neutron-dhcp-agent-ini文件" class="headerlink" title="编辑/etc/neutron/dhcp_agent.ini文件"></a>编辑/etc/neutron/dhcp_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-neutron-metadata-agent-ini文件"><a href="#编辑-etc-neutron-metadata-agent-ini文件" class="headerlink" title="编辑/etc/neutron/metadata_agent.ini文件"></a>编辑/etc/neutron/metadata_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">nova_metadata_host = controller</span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-nova-nova-conf文件"><a href="#编辑-etc-nova-nova-conf文件" class="headerlink" title="编辑/etc/nova/nova.conf文件"></a>编辑/etc/nova/nova.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[neutron]</span><br><span class="line">url = http://controller:9696</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = 000000</span><br><span class="line">service_metadata_proxy = <span class="literal">true</span></span><br><span class="line">metadata_proxy_shared_secret = METADATA_SECRET</span><br></pre></td></tr></table></figure>
<h3 id="创建链接"><a href="#创建链接" class="headerlink" title="创建链接"></a>创建链接</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># ln -s /etc/neutron/plugins/ml2/ml2_conf.ini</span></span><br><span class="line">/etc/neutron/plugin.ini</span><br></pre></td></tr></table></figure>
<h3 id="同步数据库-2"><a href="#同步数据库-2" class="headerlink" title="同步数据库"></a>同步数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># su -s /bin/sh -c &quot;neutron-db-manage --config-file</span></span><br><span class="line">/etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="line">upgrade head<span class="string">&quot; neutron</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span></span><br><span class="line"><span class="string">Running upgrade for neutron ...</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Context impl MySQLImpl.</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Will assume non-transactional DDL.</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade -&gt; kilo</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade kilo -&gt; 354db87e3225</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 354db87e3225 -&gt; 599c6a226151</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 599c6a226151 -&gt; 52c5312f6baf</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 52c5312f6baf -&gt; 313373c0ffee</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 313373c0ffee -&gt; 8675309a5c4f</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 8675309a5c4f -&gt; 45f955889773</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 45f955889773 -&gt; 26c371498592</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 26c371498592 -&gt; 1c844d1677f7</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 1c844d1677f7 -&gt; 1b4c6e320f79</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 1b4c6e320f79 -&gt; 48153cb5f051</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 48153cb5f051 -&gt; 9859ac9c136</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 9859ac9c136 -&gt; 34af2b5c5a59</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 34af2b5c5a59 -&gt; 59cb5b6cf4d</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 59cb5b6cf4d -&gt; 13cfb89f881a</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 13cfb89f881a -&gt; 32e5974ada25</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 32e5974ada25 -&gt; ec7fcfbf72ee</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade ec7fcfbf72ee -&gt; dce3ec7a25c9</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade dce3ec7a25c9 -&gt; c3a73f615e4</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade c3a73f615e4 -&gt; 659bf3d90664</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 659bf3d90664 -&gt; 1df244e556f5</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 1df244e556f5 -&gt; 19f26505c74f</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 19f26505c74f -&gt; 15be73214821</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 15be73214821 -&gt; b4caf27aae4</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade b4caf27aae4 -&gt; 15e43b934f81</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 15e43b934f81 -&gt; 31ed664953e6</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 31ed664953e6 -&gt; 2f9e956e7532</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2f9e956e7532 -&gt; 3894bccad37f</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 3894bccad37f -&gt; 0e66c5227a8a</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 0e66c5227a8a -&gt; 45f8dd33480b</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 45f8dd33480b -&gt; 5abc0278ca73</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 5abc0278ca73 -&gt; d3435b514502</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade d3435b514502 -&gt; 30107ab6a3ee</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 30107ab6a3ee -&gt; c415aab1c048</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade c415aab1c048 -&gt; a963b38d82f4</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade kilo -&gt; 30018084ec99</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 30018084ec99 -&gt; 4ffceebfada</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 4ffceebfada -&gt; 5498d17be016</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 5498d17be016 -&gt; 2a16083502f3</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2a16083502f3 -&gt; 2e5352a0ad4d</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2e5352a0ad4d -&gt; 11926bcfe72d</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 11926bcfe72d -&gt; 4af11ca47297</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 4af11ca47297 -&gt; 1b294093239c</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 1b294093239c -&gt; 8a6d8bdae39</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 8a6d8bdae39 -&gt; 2b4c2465d44b</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2b4c2465d44b -&gt; e3278ee65050</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade e3278ee65050 -&gt; c6c112992c9</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade c6c112992c9 -&gt; 5ffceebfada</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 5ffceebfada -&gt; 4ffceebfcdc</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 4ffceebfcdc -&gt; 7bbb25278f53</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 7bbb25278f53 -&gt; 89ab9a816d70</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade a963b38d82f4 -&gt; 3d0e74aa7d37</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 3d0e74aa7d37 -&gt; 030a959ceafa</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 030a959ceafa -&gt; a5648cfeeadf</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade a5648cfeeadf -&gt; 0f5bef0f87d4</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 0f5bef0f87d4 -&gt; 67daae611b6e</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 89ab9a816d70 -&gt; c879c5e1ee90</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade c879c5e1ee90 -&gt; 8fd3918ef6f4</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 8fd3918ef6f4 -&gt; 4bcd4df1f426</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 4bcd4df1f426 -&gt; b67e765a3524</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 67daae611b6e -&gt; 6b461a21bcfc</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 6b461a21bcfc -&gt; 5cd92597d11d</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 5cd92597d11d -&gt; 929c968efe70</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 929c968efe70 -&gt; a9c43481023c</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade a9c43481023c -&gt; 804a3c76314c</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 804a3c76314c -&gt; 2b42d90729da</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2b42d90729da -&gt; 62c781cb6192</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 62c781cb6192 -&gt; c8c222d42aa9</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade c8c222d42aa9 -&gt; 349b6fd605a6</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 349b6fd605a6 -&gt; 7d32f979895f</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 7d32f979895f -&gt; 594422d373ee</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 594422d373ee -&gt; 61663558142c</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 61663558142c -&gt; 867d39095bf4,</span></span><br><span class="line"><span class="string">port forwarding</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade b67e765a3524 -&gt; a84ccf28f06a</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade a84ccf28f06a -&gt; 7d9d8eeec6ad</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 7d9d8eeec6ad -&gt; a8b517cff8ab</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade a8b517cff8ab -&gt; 3b935b28e7a0</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 3b935b28e7a0 -&gt; b12a3ef66e62</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade b12a3ef66e62 -&gt; 97c25b0d2353</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 97c25b0d2353 -&gt; 2e0d7a8a1586</span></span><br><span class="line"><span class="string">INFO [alembic.runtime.migration] Running upgrade 2e0d7a8a1586 -&gt; 5c85685d616d</span></span><br><span class="line"><span class="string">OK</span></span><br></pre></td></tr></table></figure>
<h3 id="启动服务-5"><a href="#启动服务-5" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl restart openstack-nova-api</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl start neutron-server.service</span></span><br><span class="line">neutron-linuxbridge-agent.service neutron-dhcp-agent.service</span><br><span class="line">neutron-metadata-agent.service</span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable neutron-server.service</span></span><br><span class="line">neutron-linuxbridge-agent.service neutron-dhcp-agent.service</span><br><span class="line">neutron-metadata-agent.service</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-server.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-server.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-linuxbridge-agent.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-linuxbridge-agent.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-dhcp-agent.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-dhcp-agent.service.</span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-metadata-agent.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-metadata-agent.service.</span><br></pre></td></tr></table></figure>
<p>如果选择了Self-service网络，还需要启动这个服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl start neutron-l3-agent.service</span></span><br><span class="line">[root@controller ~]<span class="comment"># systemctl enable neutron-l3-agent.service</span></span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-l3-agent.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-l3-agent.service.</span><br></pre></td></tr></table></figure>
<h3 id="compute节点-2"><a href="#compute节点-2" class="headerlink" title="compute节点"></a>compute节点</h3><h3 id="安装软件包-8"><a href="#安装软件包-8" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]<span class="comment"># yum install openstack-neutron-linuxbridge ebtables ipset -y</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑配置-etc-neutron-neutron-conf文件"><a href="#编辑配置-etc-neutron-neutron-conf文件" class="headerlink" title="编辑配置/etc/neutron/neutron.conf文件"></a>编辑配置/etc/neutron/neutron.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:000000@controller</span><br><span class="line">[DEFAULT]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = 000000</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br></pre></td></tr></table></figure>
<h3 id="配置provider网络"><a href="#配置provider网络" class="headerlink" title="配置provider网络"></a>配置provider网络</h3><h3 id="编辑配置-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件"><a href="#编辑配置-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件" class="headerlink" title="编辑配置/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件"></a>编辑配置/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="配置Self-service网络-1"><a href="#配置Self-service网络-1" class="headerlink" title="配置Self-service网络"></a>配置Self-service网络</h3><h3 id="编辑配置-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件-1"><a href="#编辑配置-etc-neutron-plugins-ml2-linuxbridge-agent-ini文件-1" class="headerlink" title="编辑配置/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件"></a>编辑配置/etc/neutron/plugins/ml2/linuxbridge_agent.ini文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">true</span></span><br><span class="line">local_ip = 192.168.200.20</span><br><span class="line">l2_population = <span class="literal">true</span></span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="配置nova配置-etc-nova-nova-conf文件"><a href="#配置nova配置-etc-nova-nova-conf文件" class="headerlink" title="配置nova配置/etc/nova/nova.conf文件"></a>配置nova配置/etc/nova/nova.conf文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[neutron]</span><br><span class="line">url = http://controller:9696</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = 000000</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-6"><a href="#启动服务-6" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]<span class="comment"># systemctl restart openstack-nova-compute</span></span><br><span class="line">[root@compute ~]<span class="comment"># systemctl start neutron-linuxbridge-agent.service</span></span><br><span class="line">[root@compute ~]<span class="comment"># systemctl enable neutron-linuxbridge-agent.service</span></span><br><span class="line">Created symlink from</span><br><span class="line">/etc/systemd/system/multi-user.target.wants/neutron-linuxbridge-agent.service to</span><br><span class="line">/usr/lib/systemd/system/neutron-linuxbridge-agent.service.</span><br></pre></td></tr></table></figure>
<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack network agent list</span></span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| ID | Agent Type | Host | Availability Zone | Alive | State | Binary |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| 06323fbc-0b13-4c14-a05d-d414678177bf | Linux bridge agent | controller |</span><br><span class="line">None | :-) | UP | neutron-linuxbridge-agent |</span><br><span class="line">| 4bd1d3eb-d178-4ff5-8d3f-7307a4415209 | Linux bridge agent | compute | None</span><br><span class="line">| :-) | UP | neutron-linuxbridge-agent |</span><br><span class="line">| 74ba6229-1449-40c7-a0de-53688fbb560a | Metadata agent | controller | None</span><br><span class="line">| :-) | UP | neutron-metadata-agent |</span><br><span class="line">| d43e223f-c23d-4e60-88b6-ffe12243853f | DHCP agent | controller | nova |</span><br><span class="line">:-) | UP | neutron-dhcp-agent |</span><br><span class="line">| da0e8763-8082-4a5e-8188-7161d7ad8a05 | L3 agent | controller | nova | :-)</span><br><span class="line">| UP | neutron-l3-agent |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="安装dashboard"><a href="#安装dashboard" class="headerlink" title="安装dashboard"></a>安装dashboard</h2><h3 id="controller节点-4"><a href="#controller节点-4" class="headerlink" title="controller节点"></a>controller节点</h3><h3 id="安装软件包-9"><a href="#安装软件包-9" class="headerlink" title="安装软件包"></a>安装软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># yum install -y openstack-dashboard</span></span><br></pre></td></tr></table></figure>
<h3 id="编辑配置文件-etc-openstack-dashboard-local-settings"><a href="#编辑配置文件-etc-openstack-dashboard-local-settings" class="headerlink" title="编辑配置文件/etc/openstack-dashboard/local_settings"></a>编辑配置文件/etc/openstack-dashboard/local_settings</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_HOST = <span class="string">&quot;controller&quot;</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>]</span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">CACHES = &#123;</span><br><span class="line"><span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line"><span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;LOCATION&#x27;</span>: <span class="string">&#x27;controller:11211&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">&quot;http://%s:5000/v3&quot;</span> % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line"><span class="string">&quot;identity&quot;</span>: 3,</span><br><span class="line"><span class="string">&quot;image&quot;</span>: 2,</span><br><span class="line"><span class="string">&quot;volume&quot;</span>: 2,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">&quot;Default&quot;</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">&quot;user&quot;</span></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">...</span><br><span class="line"><span class="string">&#x27;enable_router&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_quotas&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_distributed_router&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_ha_router&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_lb&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_firewall&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_vpn&#x27;</span>: False,</span><br><span class="line"><span class="string">&#x27;enable_fip_topology_check&#x27;</span>: False,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编辑-etc-httpd-conf-d-openstack-dashboard-conf"><a href="#编辑-etc-httpd-conf-d-openstack-dashboard-conf" class="headerlink" title="编辑/etc/httpd/conf.d/openstack-dashboard.conf"></a>编辑/etc/httpd/conf.d/openstack-dashboard.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br></pre></td></tr></table></figure>
<h3 id="启动服务-7"><a href="#启动服务-7" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># systemctl restart httpd.service memcached.service</span></span><br></pre></td></tr></table></figure>
<h3 id="验证-2"><a href="#验证-2" class="headerlink" title="验证"></a>验证</h3><p>浏览器打开192.168.100.10/dashboard<br><img src="/images/mk/openstack-install-guide/dashboard.png" alt="dashboard"></p>
<h2 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h2><h3 id="创建provider网络"><a href="#创建provider网络" class="headerlink" title="创建provider网络"></a>创建provider网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># . admin-openrc</span></span><br><span class="line">[root@controller ~]<span class="comment"># openstack network create --share --external</span></span><br><span class="line">--provider-physical-network provider --provider-network-type flat provider</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up | UP |</span><br><span class="line">| availability_zone_hints | |</span><br><span class="line">| availability_zones | |</span><br><span class="line">| created_at | 2018-09-03T15:02:08Z |</span><br><span class="line">| description | |</span><br><span class="line">| dns_domain | None |</span><br><span class="line">| id | 2aa01a54-8f0b-4d13-a831-24c752fd0487 |</span><br><span class="line">| ipv4_address_scope | None |</span><br><span class="line">| ipv6_address_scope | None |</span><br><span class="line">| is_default | False |</span><br><span class="line">| is_vlan_transparent | None |</span><br><span class="line">| mtu | 1500 |</span><br><span class="line">| name | provider |</span><br><span class="line">| port_security_enabled | True |</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| provider:network_type | flat |</span><br><span class="line">| provider:physical_network | provider |</span><br><span class="line">| provider:segmentation_id | None |</span><br><span class="line">| qos_policy_id | None |</span><br><span class="line">| revision_number | 0 |</span><br><span class="line">| router:external | External |</span><br><span class="line">| segments | None |</span><br><span class="line">| shared | True |</span><br><span class="line">| status | ACTIVE |</span><br><span class="line">| subnets | |</span><br><span class="line">| tags | |</span><br><span class="line">| updated_at | 2018-09-03T15:02:08Z |</span><br><span class="line">+---------------------------+--------------------------------------+<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="创建子网"><a href="#创建子网" class="headerlink" title="创建子网"></a>创建子网</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack subnet create --network provider</span></span><br><span class="line">--allocation-pool start=192.168.200.100,end=192.168.200.200 --dns-nameserver</span><br><span class="line">114.114.114.114 --gateway 192.168.200.1 --subnet-range 192.168.200.0/24 provider</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools | 192.168.200.100-192.168.200.200 |</span><br><span class="line">| cidr | 192.168.200.0/24 |</span><br><span class="line">| created_at | 2018-09-03T15:03:51Z |</span><br><span class="line">| description | |</span><br><span class="line">| dns_nameservers | 114.114.114.114 |</span><br><span class="line">| enable_dhcp | True |</span><br><span class="line">| gateway_ip | 192.168.200.1 |</span><br><span class="line">| host_routes | |</span><br><span class="line">| id | 4d67937d-43ef-4a7f-941c-5dbef19732be |</span><br><span class="line">| ip_version | 4 |</span><br><span class="line">| ipv6_address_mode | None |</span><br><span class="line">| ipv6_ra_mode | None |</span><br><span class="line">| name | provider |</span><br><span class="line">| network_id | 2aa01a54-8f0b-4d13-a831-24c752fd0487 |</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| revision_number | 0 |</span><br><span class="line">| segment_id | None |</span><br><span class="line">| service_types | |</span><br><span class="line">| subnetpool_id | None |</span><br><span class="line">| tags | |</span><br><span class="line">| updated_at | 2018-09-03T15:03:51Z |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建Self-service网络"><a href="#创建Self-service网络" class="headerlink" title="创建Self-service网络"></a>创建Self-service网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack network create selfservice</span></span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up | UP |</span><br><span class="line">| availability_zone_hints | |</span><br><span class="line">| availability_zones | |</span><br><span class="line">| created_at | 2018-09-03T15:04:12Z |</span><br><span class="line">| description | |</span><br><span class="line">| dns_domain | None |</span><br><span class="line">| id | 1c5078e9-8dbb-47d7-976d-5ac1d8b35181 |</span><br><span class="line">| ipv4_address_scope | None |</span><br><span class="line">| ipv6_address_scope | None |</span><br><span class="line">| is_default | False |</span><br><span class="line">| is_vlan_transparent | None |</span><br><span class="line">| mtu | 1450 |</span><br><span class="line">| name | selfservice |</span><br><span class="line">| port_security_enabled | True |</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| provider:network_type | vxlan |</span><br><span class="line">| provider:physical_network | None |</span><br><span class="line">| provider:segmentation_id | 89 |</span><br><span class="line">| qos_policy_id | None |</span><br><span class="line">| revision_number | 1 |</span><br><span class="line">| router:external | Internal |</span><br><span class="line">| segments | None |</span><br><span class="line">| shared | False |</span><br><span class="line">| status | ACTIVE |</span><br><span class="line">| subnets | |</span><br><span class="line">| tags | |</span><br><span class="line">| updated_at | 2018-09-03T15:04:12Z |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]<span class="comment"># openstack subnet create --network selfservice</span></span><br><span class="line">--dns-nameserver 8.8.4.4 --gateway 172.16.1.1 --subnet-range 172.16.1.0/24</span><br><span class="line">selfservice</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools | 172.16.1.2-172.16.1.254 |</span><br><span class="line">| cidr | 172.16.1.0/24 |</span><br><span class="line">| created_at | 2018-09-03T15:04:19Z |</span><br><span class="line">| description | |</span><br><span class="line">| dns_nameservers | 8.8.4.4 |</span><br><span class="line">| enable_dhcp | True |</span><br><span class="line">| gateway_ip | 172.16.1.1 |</span><br><span class="line">| host_routes | |</span><br><span class="line">| id | fd6791d8-7a53-43fe-bc35-45168dbd13f0 |</span><br><span class="line">| ip_version | 4 |</span><br><span class="line">| ipv6_address_mode | None |</span><br><span class="line">| ipv6_ra_mode | None |</span><br><span class="line">| name | selfservice |</span><br><span class="line">| network_id | 1c5078e9-8dbb-47d7-976d-5ac1d8b35181 |</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| revision_number | 0 |</span><br><span class="line">| segment_id | None |</span><br><span class="line">| service_types | |</span><br><span class="line">| subnetpool_id | None |</span><br><span class="line">| tags | |</span><br><span class="line">| updated_at | 2018-09-03T15:04:19Z |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack router create router</span><br></pre></td></tr></table></figure>
<h3 id="创建子网接口"><a href="#创建子网接口" class="headerlink" title="创建子网接口"></a>创建子网接口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack router add subnet router selfservice</span><br></pre></td></tr></table></figure>
<h3 id="创建网关"><a href="#创建网关" class="headerlink" title="创建网关"></a>创建网关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack router <span class="built_in">set</span> router --external-gateway provider</span><br></pre></td></tr></table></figure>
<h3 id="创建类型"><a href="#创建类型" class="headerlink" title="创建类型"></a>创建类型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor create --id 0 --vcpus 1 --ram 64 --disk 1 m1.nano</span><br></pre></td></tr></table></figure>
<h3 id="创建一个Self-service网络的虚拟机"><a href="#创建一个Self-service网络的虚拟机" class="headerlink" title="创建一个Self-service网络的虚拟机"></a>创建一个Self-service网络的虚拟机</h3><p>这里的net-id是openstack network list查看到的id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack server create --flavor m1.nano --image cirros</span></span><br><span class="line">--nic net-id=1c5078e9-8dbb-47d7-976d-5ac1d8b35181 cirros</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">| Field | Value |</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig | MANUAL |</span><br><span class="line">| OS-EXT-AZ:availability_zone | |</span><br><span class="line">| OS-EXT-SRV-ATTR:host | None |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | None |</span><br><span class="line">| OS-EXT-SRV-ATTR:instance_name | |</span><br><span class="line">| OS-EXT-STS:power_state | NOSTATE |</span><br><span class="line">| OS-EXT-STS:task_state | scheduling |</span><br><span class="line">| OS-EXT-STS:vm_state | building |</span><br><span class="line">| OS-SRV-USG:launched_at | None |</span><br><span class="line">| OS-SRV-USG:terminated_at | None |</span><br><span class="line">| accessIPv4 | |</span><br><span class="line">| accessIPv6 | |</span><br><span class="line">| addresses | |</span><br><span class="line">| adminPass | Y3Vh6RnFq4C7 |</span><br><span class="line">| config_drive | |</span><br><span class="line">| created | 2018-09-03T15:08:50Z |</span><br><span class="line">| flavor | m1.nano (0) |</span><br><span class="line">| hostId | |</span><br><span class="line">| id | 38339165-fb68-4657-8ca6-457370a2202e |</span><br><span class="line">| image | cirros (8faa9dc9-7f29-4570-ae87-9bab0d01aa63) |</span><br><span class="line">| key_name | None |</span><br><span class="line">| name | cirros |</span><br><span class="line">| progress | 0 |</span><br><span class="line">| project_id | 1a74d2a87e734feea8577477955e0b06 |</span><br><span class="line">| properties | |</span><br><span class="line">| security_groups | name=<span class="string">&#x27;default&#x27;</span> |</span><br><span class="line">| status | BUILD |</span><br><span class="line">| updated | 2018-09-03T15:08:50Z |</span><br><span class="line">| user_id | 5238d646322346be9e3f9750422bcf4d |</span><br><span class="line">| volumes_attached | |</span><br><span class="line">+-------------------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="查看是否创建成功"><a href="#查看是否创建成功" class="headerlink" title="查看是否创建成功"></a>查看是否创建成功</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]<span class="comment"># openstack server list</span></span><br><span class="line">+--------------------------------------+--------+--------+-------------------------+--------+---------+</span><br><span class="line">| ID | Name | Status | Networks | Image | Flavor |</span><br><span class="line">+--------------------------------------+--------+--------+-------------------------+--------+---------+</span><br><span class="line">| 38339165-fb68-4657-8ca6-457370a2202e | cirros | ACTIVE |</span><br><span class="line">selfservice=172.16.1.25 | cirros | m1.nano |</span><br><span class="line">+--------------------------------------+--------+--------+-------------------------+--------+---------+</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>zerchin
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://blog.zerchin.xyz/2018/09/04/CentOS7.5%E5%AE%89%E8%A3%85OpenStack_Rocky%E7%89%88%E6%9C%AC/" title="CentOS7.5安装OpenStack Rocky版本">http://blog.zerchin.xyz/2018/09/04/CentOS7.5安装OpenStack_Rocky版本/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/openstack/" rel="tag"># openstack</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/08/15/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" rel="prev" title="MySQL数据库主从复制">
                  <i class="fa fa-chevron-left"></i> MySQL数据库主从复制
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/09/04/ubuntu12.04%E6%89%8B%E5%8A%A8%E6%90%AD%E5%BB%BAceph0.87(giant%E7%89%88%E6%9C%AC)%E5%8D%95%E8%8A%82%E7%82%B9/" rel="next" title="ubuntu12.04手动搭建ceph0.87(giant版本)单节点">
                  ubuntu12.04手动搭建ceph0.87(giant版本)单节点 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">null </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zerchin</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="//cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>

<script src="/js/local-search.js"></script>





  <script>
    NProgress.configure({
      showSpinner: true
    });
    NProgress.start();
    document.addEventListener('readystatechange', () => {
      if (document.readyState === 'interactive') {
        NProgress.inc(0.8);
      }
      if (document.readyState === 'complete') {
        NProgress.done();
      }
    });
    document.addEventListener('pjax:send', () => {
      NProgress.start();
    });
    document.addEventListener('pjax:success', () => {
      NProgress.done();
    });
  </script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</body>
</html>
